<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Specially For You ‚Äî Panda Edition üêº</title>

<!-- Kawaii font -->
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;700&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#f6fbff;
    --panel:#ffffff;
    --accent:#ffd166;
    --muted:#6b7280;
    --bamboo:#95d5a7;
    --paw:#ffd8d8;
  }
  html,body{height:100%;margin:0;font-family:'Baloo 2',system-ui,Segoe UI,Roboto,Arial;}
  body{
    background:
      radial-gradient(circle at 12% 18%, rgba(149,213,167,0.12), transparent 6%),
      linear-gradient(180deg,#ecf9f4 0%, #f6fbff 100%);
    display:flex;align-items:center;justify-content:center;padding:18px;
    color:#0f1724;
  }

  .stage{
    width:100%;max-width:980px;border-radius:18px;background:var(--panel);
    box-shadow:0 18px 40px rgba(15,23,36,0.12);overflow:hidden;border:3px solid #e6f6eb;
    position:relative;padding:18px 18px 84px 18px;
  }

  /* Bamboo border top & bottom */
  .stage::before, .stage::after{
    content:"";position:absolute;left:0;right:0;height:34px;background-repeat:repeat-x;
    background-size:64px 34px;
  }
  .stage::before{
    top:0;
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="64" height="34"><g fill="%2395d5a7"><rect x="0" y="0" width="14" height="34" rx="3"/><rect x="18" y="0" width="14" height="34" rx="3"/><rect x="36" y="0" width="14" height="34" rx="3"/><rect x="54" y="0" width="10" height="34" rx="3"/></g></svg>');
  }
  .stage::after{
    bottom:0;transform:rotate(180deg);
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="64" height="34"><g fill="%2395d5a7"><rect x="0" y="0" width="14" height="34" rx="3"/><rect x="18" y="0" width="14" height="34" rx="3"/><rect x="36" y="0" width="14" height="34" rx="3"/><rect x="54" y="0" width="10" height="34" rx="3"/></g></svg>');
  }

  header{display:flex;justify-content:space-between;align-items:center;padding:6px 10px 18px 10px}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:64px;height:64px;border-radius:12px;background:linear-gradient(180deg,var(--accent),#ff8a00);display:flex;align-items:center;justify-content:center;color:#081016;font-weight:800;font-size:20px}
  .title{font-size:20px;font-weight:700}
  .subtitle{color:var(--muted);font-size:13px}

  .content{display:flex;gap:18px;align-items:stretch}
  .card{
    flex:1;background:linear-gradient(180deg,rgba(255,255,255,0.6),#ffffff);border-radius:12px;padding:18px;border:1px solid rgba(0,0,0,0.04);
    position:relative;min-width:300px;
  }

  .panda-area{
    width:320px;min-width:260px;border-radius:12px;padding:18px;background:linear-gradient(180deg,#ffffff, #fbfdff);
    display:flex;flex-direction:column;align-items:center;justify-content:center;border:1px dashed rgba(0,0,0,0.04);
  }

  .greeting{font-size:26px;font-weight:700;margin:6px 0 8px 0}
  .message{color:var(--muted);font-size:15px;margin-bottom:12px;min-height:44px}

  /* custom message input */
  .msg-input{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(6,7,8,0.06);font-size:15px;resize:none;min-height:84px}
  .controls{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap}

  button{cursor:pointer;border:0;padding:10px 12px;border-radius:10px;font-weight:700;background:linear-gradient(90deg,#fff,#f8f9ff);box-shadow:0 6px 18px rgba(2,6,23,0.05)}
  .primary{background:linear-gradient(90deg,var(--accent),#ff8a00);color:#081016}
  .ghost{background:transparent;border:1px solid rgba(0,0,0,0.06)}

  /* panda svg container */
  .panda-wrap{position:relative;width:220px;height:220px;display:flex;align-items:center;justify-content:center}
  svg.panda{width:220px;height:220px;overflow:visible;display:block}

  /* panda animations */
  .arm-left, .arm-right{transform-origin:50% 20%}
  .arm-left.wave { animation: wave-left 900ms ease-in-out 0s 3; }
  .arm-right.wave { animation: wave-right 900ms ease-in-out 0s 3; }
  @keyframes wave-left{
    0%{ transform: rotate(0deg); }
    30%{ transform: rotate(-28deg); }
    60%{ transform: rotate(10deg); }
    100%{ transform: rotate(0deg); }
  }
  @keyframes wave-right{
    0%{ transform: rotate(0deg); }
    30%{ transform: rotate(28deg); }
    60%{ transform: rotate(-10deg); }
    100%{ transform: rotate(0deg); }
  }

  /* heart pop */
  .heart{transform-origin:center;opacity:0;transform:translateY(6px) scale(0.6);}
  .heart.show{ animation: heart-pop 650ms cubic-bezier(.2,.9,.2,1) forwards; }
  @keyframes heart-pop{
    0%{ opacity:0; transform:translateY(12px) scale(0.6); }
    40%{ opacity:1; transform:translateY(0px) scale(1.16); }
    100%{ opacity:1; transform:translateY(0px) scale(1); }
  }

  /* gift pop out */
  .gift{transform-origin:center bottom;transform:translateY(44px) scale(0.8);opacity:0}
  .gift.show{ animation: gift-pop 700ms cubic-bezier(.25,.85,.25,1) forwards; }
  @keyframes gift-pop{
    0%{ transform:translateY(40px) scale(0.8); opacity:0 }
    60%{ transform:translateY(-8px) scale(1.05); opacity:1 }
    100%{ transform:translateY(0px) scale(1); opacity:1 }
  }

  /* panda blink (eyes) */
  .eye-blink{ transform-origin:center; animation: blink 4.6s infinite; }
  @keyframes blink{
    0%,96%,100%{ transform: scaleY(1); }
    97%,99%{ transform: scaleY(0.08); }
  }

  /* paw stamps */
  .stamps{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap}
  .stamp{width:46px;height:46px;border-radius:8px;background:linear-gradient(180deg,#fff,#fff);display:flex;align-items:center;justify-content:center;border:1px solid rgba(0,0,0,0.04);cursor:pointer}
  .stamp.pressed{box-shadow:inset 0 2px 6px rgba(0,0,0,0.05);transform:translateY(2px)}

  /* message preview with panda stamps overlay */
  .preview{
    margin-top:12px;border-radius:10px;padding:12px;border:2px dashed rgba(0,0,0,0.04);min-height:100px;background:linear-gradient(180deg,#fff,#fbfdff);
    position:relative;
  }
  .paw-print{position:absolute;width:56px;height:56px;opacity:0.12;pointer-events:none;transform:translate(-50%,-50%);filter:drop-shadow(0 8px 12px rgba(4,8,20,0.04));}

  footer{position:absolute;left:18px;right:18px;bottom:18px;display:flex;justify-content:space-between;align-items:center;color:var(--muted);font-size:13px}
  @media(max-width:820px){
    .content{flex-direction:column-reverse}
    .panda-area{width:100%}
    .card{width:100%}
    .panda-wrap{width:180px;height:180px}
    svg.panda{width:180px;height:180px}
  }
</style>
</head>
<body>
  <div class="stage" id="stage">
    <header>
      <div class="brand">
        <div class="logo">SFY</div>
        <div>
          <div class="title">Specially For You</div>
          <div class="subtitle">Panda Edition ‚Äî kawaii vibes üêº</div>
        </div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <button id="copy-link" class="ghost">Copy Share Link</button>
        <button id="save-btn" class="ghost">Save as Image</button>
        <button id="open-btn" class="primary">Open Surprise</button>
      </div>
    </header>

    <div class="content">
      <!-- left: controls + preview -->
      <div class="card" id="left-card">
        <div class="greeting" id="greeting">Specially for Friend</div>
        <div class="message" id="submsg">Wishing you a joyful day ‚Äî here's a panda to make you smile!</div>

        <label for="msg" style="font-weight:700;margin-top:8px;display:block">Custom message</label>
        <textarea id="msg" class="msg-input" placeholder="Write your message...">Wishing you happiness and a day full of surprises!</textarea>

        <div class="controls">
          <button id="apply-msg" class="primary">Apply Message</button>
          <button id="wave-btn">Panda Wave</button>
          <button id="heart-btn">Show Heart</button>
          <button id="gift-btn">Pop Gift</button>
        </div>

        <div style="margin-top:10px;font-weight:700">Panda Stamps</div>
        <div class="stamps" id="stamps">
          <div class="stamp" data-stamp="paw1" title="Paw small">üêæ</div>
          <div class="stamp" data-stamp="paw2" title="Paw medium">üêº</div>
          <div class="stamp" data-stamp="paw3" title="heart">üíñ</div>
        </div>

        <div class="preview" id="preview">
          <div id="preview-text" style="font-size:15px;color:#0f1724;line-height:1.3">
            Wishing you happiness and a day full of surprises!
          </div>
          <!-- paw prints will be inserted here -->
        </div>
      </div>

      <!-- right: panda + decorations -->
      <div class="panda-area">
        <div class="panda-wrap">
          <!-- Inline SVG panda with parts (arms, heart, gift) separate for animation -->
          <svg class="panda" viewBox="0 0 220 220" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <defs>
              <filter id="soft" x="-50%" y="-50%" width="200%" height="200%">
                <feDropShadow dx="0" dy="6" stdDeviation="10" flood-color="#000" flood-opacity="0.12"/>
              </filter>
            </defs>

            <!-- shadow -->
            <ellipse cx="110" cy="198" rx="62" ry="12" fill="#000" opacity="0.06"/>

            <!-- body -->
            <g id="body" transform="translate(0,10)">
              <ellipse cx="110" cy="130" rx="58" ry="52" fill="#fff" stroke="#000" stroke-opacity="0.06"/>
              <!-- head -->
              <g id="head" transform="translate(0,0)">
                <circle cx="110" cy="70" r="46" fill="#fff"/>
                <!-- ear left -->
                <ellipse class="ear" cx="78" cy="38" rx="18" ry="20" fill="#000"/>
                <!-- ear right -->
                <ellipse class="ear" cx="142" cy="38" rx="18" ry="20" fill="#000"/>
                <!-- eyes patches -->
                <ellipse cx="90" cy="72" rx="14" ry="18" fill="#000"/>
                <ellipse cx="130" cy="72" rx="14" ry="18" fill="#000"/>

                <!-- eyes (blink animated via scaleY) -->
                <g fill="#fff" id="eyes">
                  <ellipse class="eye-blink" cx="90" cy="74" rx="6" ry="6"/>
                  <ellipse class="eye-blink" cx="130" cy="74" rx="6" ry="6"/>
                </g>

                <!-- nose -->
                <path d="M110 82 q6 6 -12 0" fill="#111" transform="translate(0,0)"/>
                <!-- mouth -->
                <path d="M102 88 q8 8 16 0" stroke="#111" stroke-width="2" fill="none" stroke-linecap="round"/>
              </g>

              <!-- arms -->
              <g id="arms" transform="translate(0,18)">
                <g id="left-arm" class="arm-left" transform="translate(55,110)">
                  <ellipse cx="0" cy="0" rx="18" ry="26" fill="#000"/>
                </g>
                <g id="right-arm" class="arm-right" transform="translate(165,110)">
                  <ellipse cx="0" cy="0" rx="18" ry="26" fill="#000"/>
                </g>
              </g>

              <!-- heart (hidden until shown) -->
              <g id="heart" class="heart" transform="translate(110,90)">
                <path d="M0 -6
                  c -6 -10 -26 -6 -26 6
                  c0 10 12 18 26 30
                  c14 -12 26 -20 26 -30
                  c0 -12 -20 -16 -26 -6 z" fill="#ff6b81">
                </path>
              </g>

              <!-- gift box (hidden until shown) -->
              <g id="gift" class="gift" transform="translate(110,150)">
                <rect x="-28" y="0" width="56" height="40" rx="6" fill="#2b8a90"/>
                <rect x="-26" y="2" width="12" height="36" fill="#ffcdd2"/>
                <rect x="14" y="2" width="12" height="36" fill="#ffcdd2"/>
                <path d="M0 0 v -12 q0 -6 8 -6 q8 0 8 6 v12" fill="#2b8a90" opacity="0.0"></path>
                <path d="M-28 0 q28 -26 56 0" fill="#ffffff" opacity="0.02"/>
              </g>
            </g>
          </svg>
        </div>

        <div style="margin-top:8px;color:var(--muted);font-weight:700">Your little panda</div>
        <div style="font-size:13px;color:var(--muted);margin-top:6px;text-align:center">It can wave, show a heart, and pop out of a gift!</div>
      </div>
    </div>

    <footer>
      <div id="credits">Made with ‚ô• ‚Äî customize me</div>
      <div style="display:flex;gap:8px">
        <button id="reset-btn" class="ghost">Reset</button>
      </div>
    </footer>
  </div>

  <!-- JS libs -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
/* -------------------------
  Utilities & initial setup
---------------------------*/
const urlParams = new URL(location.href).searchParams;
const nameParam = urlParams.get('name') || urlParams.get('mcp_name') || '';
const greetingEl = document.getElementById('greeting');
const submsgEl = document.getElementById('submsg');
const msgInput = document.getElementById('msg');
const previewText = document.getElementById('preview-text');

if (nameParam) {
  greetingEl.textContent = `Specially for ${decodeURIComponent(nameParam)}`;
  submsgEl.textContent = `Hey ${decodeURIComponent(nameParam)}, your panda friend is here!`;
}

/* -------------------------
  Panda parts
---------------------------*/
const leftArm = document.querySelector('#left-arm');
const rightArm = document.querySelector('#right-arm');
const heart = document.getElementById('heart');
const gift = document.getElementById('gift');
const pandaSvg = document.querySelector('svg.panda');

function clearAnimations(){
  leftArm.classList.remove('wave');
  rightArm.classList.remove('wave');
  heart.classList.remove('show');
  gift.classList.remove('show');
  // remove temporary stamps classes
  document.querySelectorAll('.stamp').forEach(s=>s.classList.remove('pressed'));
  // remove preview paw elements
  document.querySelectorAll('.paw-print').forEach(e=>e.remove());
}

/* -------------------------
  Sound effects (WebAudio)
---------------------------*/
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function playPop(){
  const now = audioCtx.currentTime;
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = 'triangle';
  o.frequency.setValueAtTime(380, now);
  o.frequency.exponentialRampToValueAtTime(120, now + 0.22);
  g.gain.setValueAtTime(0.001, now);
  g.gain.exponentialRampToValueAtTime(0.35, now + 0.02);
  g.gain.exponentialRampToValueAtTime(0.001, now + 0.5);
  o.connect(g); g.connect(audioCtx.destination);
  o.start(now); o.stop(now + 0.6);
}

function playChime(){
  const now = audioCtx.currentTime;
  const freqs = [880, 1220, 660];
  freqs.forEach((f, i) => {
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = 'sine';
    o.frequency.setValueAtTime(f, now + i * 0.06);
    g.gain.setValueAtTime(0.0001, now + i * 0.06);
    g.gain.exponentialRampToValueAtTime(0.4, now + i * 0.06 + 0.01);
    g.gain.exponentialRampToValueAtTime(0.0001, now + i * 0.06 + 0.4);
    o.connect(g); g.connect(audioCtx.destination);
    o.start(now + i * 0.06); o.stop(now + i * 0.06 + 0.6);
  });
}

/* -------------------------
  Button behaviors
---------------------------*/
document.getElementById('apply-msg').addEventListener('click', ()=>{
  const txt = msgInput.value.trim() || 'Sending warm wishes!';
  previewText.textContent = txt;
});

document.getElementById('wave-btn').addEventListener('click', ()=>{
  // brief wave
  leftArm.classList.add('wave');
  rightArm.classList.add('wave');
  playChime();
  setTimeout(()=> { leftArm.classList.remove('wave'); rightArm.classList.remove('wave'); }, 1400);
});

document.getElementById('heart-btn').addEventListener('click', ()=>{
  heart.classList.add('show');
  playChime();
  setTimeout(()=> heart.classList.remove('show'), 2000);
});

document.getElementById('gift-btn').addEventListener('click', ()=>{
  gift.classList.add('show');
  playPop();
  // also wiggle panda a bit
  pandaSvg.animate([
    { transform: 'translateY(0px) },
    { transform: 'translateY(-10px) },
    { transform: 'translateY(0px)' }
  ], { duration: 650, easing: 'cubic-bezier(.2,.8,.2,1)' });
  setTimeout(()=> gift.classList.remove('show'), 2500);
});

/* Stamp clicking -> place paw prints into preview */
document.getElementById('stamps').addEventListener('click', (ev)=>{
  const s = ev.target.closest('.stamp');
  if(!s) return;
  s.classList.add('pressed');
  setTimeout(()=> s.classList.remove('pressed'), 180);
  const type = s.dataset.stamp;
  placeStamp(type);
});

function placeStamp(type){
  const preview = document.getElementById('preview');
  const x = 20 + Math.random()*60;
  const y = 20 + Math.random()*60;
  const el = document.createElement('div');
  el.className = 'paw-print';
  el.style.left = x + '%';
  el.style.top = y + '%';
  // choose SVG paw or heart depending on type
  if(type === 'paw1') el.innerHTML = `<svg width="56" height="56" viewBox="0 0 100 100"><g fill="#ffd8d8"><circle cx="24" cy="24" r="10"/><circle cx="38" cy="12" r="8"/><circle cx="12" cy="12" r="8"/><path d="M50 36c-18 0-32 14-32 32s14 32 32 32 32-14 32-32-14-32-32-32z"/></g></svg>`;
  else if(type === 'paw2') el.innerHTML = `<svg width="56" height="56" viewBox="0 0 100 100"><g fill="#cdebb1"><circle cx="70" cy="28" r="7"/><circle cx="54" cy="16" r="6"/><circle cx="86" cy="16" r="6"/><path d="M50 36c-18 0-32 14-32 32s14 32 32 32 32-14 32-32-14-32-32-32z" fill="#fff"/></g></svg>`;
  else el.innerHTML = `<svg width="56" height="56" viewBox="0 0 100 100"><g fill="#ffd1e0"><path d="M50 22c-8-12-28-8-28 8 0 8 6 12 14 18 8 6 18 14 18 14s10-8 18-14c8-6 14-10 14-18 0-16-20-20-28-8z"/></g></svg>`;
  preview.appendChild(el);
}

/* -------------------------
  Open Surprise: do everything
---------------------------*/
document.getElementById('open-btn').addEventListener('click', async ()=>{
  // activate audio context on user gesture if suspended
  if(audioCtx.state === 'suspended') await audioCtx.resume();

  // confetti bursts
  confetti({particleCount: 70, spread: 110, origin:{x:0.2,y:0.25}});
  confetti({particleCount: 70, spread: 110, origin:{x:0.8,y:0.25}});

  // wave + heart + gift in a sequence
  leftArm.classList.add('wave');
  rightArm.classList.add('wave');
  setTimeout(()=> { heart.classList.add('show'); playChime(); }, 420);
  setTimeout(()=> { gift.classList.add('show'); playPop(); }, 1000);

  // small panda hop
  pandaSvg.animate([
    { transform: 'translateY(0px)'},
    { transform: 'translateY(-12px)'},
    { transform: 'translateY(0px)'}
  ], { duration: 900, easing: 'cubic-bezier(.2,.8,.2,1)' });

  // cleanup after a few seconds
  setTimeout(()=> {
    leftArm.classList.remove('wave');
    rightArm.classList.remove('wave');
    setTimeout(()=> { heart.classList.remove('show'); gift.classList.remove('show'); }, 1200);
  }, 1800);

  // small celebratory chime
  setTimeout(()=> playChime(), 1400);
});

/* -------------------------
  Copy link, save as image, reset
---------------------------*/
document.getElementById('copy-link').addEventListener('click', async ()=>{
  try{
    await navigator.clipboard.writeText(location.href);
    alert('Share link copied!');
  }catch(e){
    prompt('Copy this link:', location.href);
  }
});

document.getElementById('save-btn').addEventListener('click', async ()=>{
  // hide controls while capturing for clean image
  const footer = document.querySelector('footer');
  footer.style.opacity = '0';
  document.querySelectorAll('.stamp').forEach(s=>s.style.opacity = '0');
  // render
  await html2canvas(document.getElementById('stage'), {scale:2, useCORS:true}).then(canvas=>{
    const a = document.createElement('a');
    a.href = canvas.toDataURL('image/png');
    a.download = 'panda_greeting.png';
    a.click();
  }).catch(e=> alert('Save failed ‚Äî try screenshot'));
  // restore
  footer.style.opacity = '';
  document.querySelectorAll('.stamp').forEach(s=>s.style.opacity = '');
});

document.getElementById('reset-btn').addEventListener('click', ()=>{
  clearAnimations();
  previewText.textContent = 'Wishing you happiness and a day full of surprises!';
  msgInput.value = previewText.textContent;
  document.querySelectorAll('.paw-print').forEach(e=>e.remove());
});

/* Auto-apply sample message */
document.getElementById('apply-msg').click();

/* Make sure interaction unlocks audio on iOS/Safari */
document.body.addEventListener('click', function unlockAudio(){ if(audioCtx.state === 'suspended') audioCtx.resume().catch(()=>{}); document.body.removeEventListener('click', unlockAudio); });
</script>
</body>
</html>
